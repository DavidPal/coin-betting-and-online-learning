\section{Coin-Betting Potentials}
\label{section:coin-betting-potentials}

\citet{Kelly-1956} proposed a general strategy for sequential bets. For coin
betting, the strategy assumes that the coin flips $\{g_t\}_{t=1}^\infty$, $g_t
\in \{+1,-1\}$, are generated i.i.d. with known probability of heads. If $p \in
[0,1]$ is the probability of heads, the Kelly bet is
$\beta_t = 2p - 1$.
He showed that this strategy maximizes $\Exp[\ln(\Wealth_t)]$.

For adversarial coins, Kelly betting does not make sense. However, we can
replace $p$ with an estimate. In turn, this problem was studied by \citet{Krichevsky-Trofimov-1981},
who proposed that after seeing coin flips $g_1, g_2, \dots, g_{t-1}$ an
empirical estimate $k_t = \frac{1/2 + \sum_{i=1}^{t-1} \indicator[g_i = +1]}{t}$
should be used instead of $p$. Their estimate is commonly called \emph{KT
estimator}.\footnote{Compared to the maximum likelihood estimate
$\frac{\sum_{i=1}^{t-1} \indicator[g_i = +1]}{t-1}$, KT estimator ``shrinks''
slightly towards $\nicefrac{1}{2}$.} KT estimator results in the betting strategy
\begin{equation}
\label{equation:kt-estimator-betting-strategy}
\beta_t = 2k_t - 1 = \tfrac{\sum_{i=1}^{t-1} g_i}{t}
\end{equation}
which we call \emph{adaptive Kelly betting based on KT estimator}.
\citeauthor{Krichevsky-Trofimov-1981} showed that
\[
\forall \beta \in [-1,1] \qquad \qquad \ln(\Wealth_t) \ge \ln(\Wealth_t(\beta)) \ - \ \tfrac{1}{2} \ln t \ - \ \ln(2) \; ,
\]
where $\Wealth_t(\beta)$ is the wealth of a strategy that bets the same
fraction $\beta$ in every round. This guarantee is optimal up to constant
additive factors~\citep{Cesa-Bianchi-Lugosi-2006}.

Here, we consider betting strategies that can be viewed as abstractions of
adaptive Kelly betting based on KT estimator. For these strategies it is
possible to prove that for any $g_1, g_2, \dots, g_t \in [-1,1]$,
\begin{equation}
\label{equation:wealth-lower-bound-generic}
\Wealth_t \ge F_t \left( \sum_{i=1}^t g_i \right) \; ,
\end{equation}
where $F_t(x)$ is a certain function. We call such functions \emph{potentials}.
We consider potential-based strategy that in round $t$ chooses fraction
\begin{equation}
\label{equation:potential-based-strategy}
\beta_t = \tfrac{F_t(\sum_{i=1}^{t-1} g_i + 1) - F_t(\sum_{i=1}^{t-1} g_i - 1)}{F_t(\sum_{i=1}^{t-1} g_i + 1) + F_t(\sum_{i=1}^{t-1} g_i - 1)} \; .
\end{equation}
If $F_t(x)$ is positive, $\beta_t \in (-1,1)$ and hence it is a valid
strategy. However, without further conditions on the sequence of potentials
$\{F_t\}_{t=0}^\infty$ is is not clear if the strategy
\eqref{equation:potential-based-strategy} implies the lower bound
\eqref{equation:wealth-lower-bound-generic} on its wealth. We restrict our
attention to potentials for which \eqref{equation:wealth-lower-bound-generic}
holds; these are specified in the definition below.

\begin{definition}[Coin-Betting Potential]
\label{definition:potential}
Let $\epsilon > 0$. Let $\{F_t\}_{t=0}^\infty$ be a sequence of functions
$F_t:I_t  \to \R_+$ where $I_t = (-a_t, a_t)$ is an open symmetric
interval\footnote{We allow $a_t = +\infty$.} containing $[-t,t]$.  The sequence
$\{F_t\}_{t=0}^\infty$ is called a \textbf{sequence of coin-betting potentials
for initial endowment $\epsilon$}, if it satisfies the following three
conditions:
\begin{enumerate}[(1)]
\item $F_0(0) = \epsilon$.

\item For every $t \ge 0$, $F_t(x)$ is even, logarithmically convex, strictly
increasing on $[0,a_t)$, and
\begin{equation}
\label{equation:potential-limit-assumption}
\lim_{x \nearrow a_t} F_t(x) = \lim_{x \searrow -a_t} F_t(x) = +\infty \; .
\end{equation}

\item For every $t \ge 1$, every $x \in [-(t-1), (t-1)]$ and every $g \in [-1,1]$,
\[
\left(1 + g \tfrac{F_t(x + 1) - F_t(x - 1)}{F_t(x + 1) + F_t(x - 1)} \right) F_{t-1}(x) \ge F_t(x+g) \; .
\]
\end{enumerate}
The sequence $\{F_t\}_{t=0}^\infty$ is called a
\textbf{sequence of excellent coin-betting potentials for initial
endowment $\epsilon$} if it satisfies conditions (1)--(3) and the condition (4)
below.
\begin{enumerate}[(1)]
\setcounter{enumi}{3}
\item For every $t \ge 0$, $F_t$ is twice-differentiable and
satisfies $x \cdot F_t''(x) \ge F_t'(x)$ for every $x \in I_t$.
\end{enumerate}
\end{definition}

It is a routine exercise to show by induction on $t$ that conditions 2 and 3 of
the definition together with recurrence \eqref{equation:wealth-recurrence} imply
that the \emph{potential based strategy}
\eqref{equation:potential-based-strategy} satisfies
\eqref{equation:wealth-lower-bound-generic}. The base case $t=0$ is trivial,
since both sides of \eqref{equation:wealth-lower-bound-generic} are equal to
$\epsilon$. For $t \ge 1$, if we let $x = \sum_{i=1}^{t-1} g_i$, then
\[
\Wealth_t
= (1+g_t \beta_t) \Wealth_{t-1}
\ge (1 + g_t \beta_t) F_{t-1}(x)
\ge F_t(x + g_t)
= F_t \left( \sum_{i=1}^t g_i \right) \; .
\]

The formula for the potential-based
strategy~\eqref{equation:potential-based-strategy} might seem strange. However,
it is derived by minimizing worst-case value the rhs of the inequality used wrt to $g_t$ in the induction proof above
\[
F_{t-1}(x) \ge \tfrac{F_{t}(x + g_t)}{1+g_t\beta_t} \; .
\]
For a proof see Theorem~\ref{theorem:optimal-betting-fraction} in Appendix~\ref{section:optimal-betting-fraction}.

% Dividing through $1+g_t\beta_t$, the left-hand
% side becomes independent of $g_t$ and $\beta_t$ and the right-hand side becomes
% a function of $\beta_t$ and $g_t$,
% $$
% h(g_t, \beta_t) = \tfrac{F_{t}(x + g_t)}{1 + g_t\beta_t}
% $$
% Since $g_t \in [-1,1]$ is chosen by an adversary, our best hope is to find
% $\beta_t$ that minimizes $\max_{g_t \in [-1,1]} h(g_t,\beta_t)$. Solution of
% this minimization problem is $\beta_t$ given by
% \eqref{equation:potential-based-strategy}.

We will show concrete examples of sequences of coin-betting potentials in
Section~\ref{section:kt-estimator}. In the next two sections we show how to use this framework to solve \ac{OLO} and \ac{LEA}.
